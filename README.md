# cf-cloudflare-worker-s3-uploader

# üöÄ Cloudflare Worker for uploading images to Amazon S3 üöÄ

https://github.com/coding-to-music/cf-cloudflare-worker-s3-uploader

From / By https://github.com/yusukebe/cf-s3-uploader

## Environment variables:

wrangler.example.toml

```java
account_id = ""
compatibility_date = "2021-11-01"
name = "s3-uploader"
route = ""
type = "javascript"
workers_dev = true
zone_id = ""

[site]
bucket = "./public"
entry-point = "./"

[build]
command = "npm install && npm run build"
[build.upload]
format = "service-worker"

[vars]
S3_BUCKET = "your_bucket_name"
S3_FOLDER = "folder-name/"
S3_REGION = "s3_region_name"

[secrets]
# NAME
# PASS
# AWS_ID
# AWS_SECRET
```

## GitHub

```java
git init
git add .
git remote remove origin
git commit -m "first commit"
git branch -M main
git remote add origin git@github.com:coding-to-music/cf-cloudflare-worker-s3-uploader.git
git push -u origin main
```

# cf-s3-uploader

Cloudflare Worker for uploading images to Amazon S3.

## Set up

First, git clone:

```bash
$ https://github.com/yusukebe/cf-s3-uploader.git
$ cd cf-s3-uploader
```

Copy `wrangler.exmple.toml` to `wrangler.tmol`:

```bash
$ cp wrangler.example.toml wrangler.toml
```

## Variables

### Environment variables

Enviroment variables are:

- `S3_BUCKET` - Your S3 bucket name
- `S3_REGION` - S3 region name

To set these, `wrangler.toml`

```toml
[vars]
S3_BUCKET = "your_bucket_name"
S3_REGION = "s3_region_name"
```

### Secret variables

Secret variables are:

- `NAME` - User name of basic auth
- `PASS` - User password of basic auth
- `AWS_ID` - AWS access key ID
- `AWS_SECRET` - AWS secret access key

To set these, use `wrangler secret put` command:

```bash
$ wrangler secret put NAME
```

## Publish

To publish to your Cloudflare Workers:

```bash
$ wrangler publish
```

## Endpoints

### `/upload`

Header:

To pass the Basic Auth, add the Base64 string of "user:pass" to `Authorization` header.

```
Authorization: Basic ...
```

Body:

Value of `body` is Basic64 string of image binary.

```json
{
  "body": "Base64 Text..."
}
```

## Use with Shortcuts

Awesome!!!

![Screenshot](https://user-images.githubusercontent.com/10682/139781916-8c22a6ae-b21b-48ff-ad1c-08d396f5cdd0.gif)

Setting shortcuts like this:

![Screenshot](https://s3.ap-northeast-1.amazonaws.com/yusukebe.com/images/57f68c29ea5d0af4e9480ad04e89d152.png)

## Author

Yusuke Wada <https://github.com/yusukebe>

## LICENSE

MIT

# Wrangler login

Authorize Wrangler with your Cloudflare account using OAuth. Wrangler will attempt to automatically open your web browser to login with your Cloudflare account.

If you prefer to use API tokens for authentication, such as in headless or continuous integration environments, refer to Running Wrangler in CI/CD.

```
wrangler login [OPTIONS]
```

```
--scopes-list  optional
```

- List all the available OAuth scopes with descriptions.

```
--scopes $SCOPES  optional
```

- Allows to choose your set of OAuth scopes. The set of scopes must be entered in a whitespace-separated list, for example, $ wrangler login --scopes account:read user:read.

```
wrangler login uses all the available scopes by default if no flags are provided.
```

If Wrangler fails to open a browser, you can copy and paste the URL generated by wrangler login in your terminal into a browser and log in.

## ‚Äã‚ÄãUsing wrangler login on a remote machine

If you are using Wrangler from a remote machine, but run the login flow from your local browser, you will receive the following error message after logging in:This site can't be reached.

To finish the login flow, run wrangler login and go through the login flow in the browser:

```
wrangler login

wrangler login ‚õÖÔ∏è wrangler 2.1.6
-------------------
Attempting to login via OAuth...Opening a link in your default browser: 
https://dash.cloudflare.com/oauth2/auth?xyz...
```

The browser login flow will redirect you to a localhost URL on your machine.

Leave the login flow active. Open a second terminal session. In that second terminal session, use curl or an equivalent request library on the remote machine to fetch this localhost URL. Copy and paste the localhost URL that was generated during the wrangler login flow and run:

```
curl <LOCALHOST_URL>
```

## Important - open port 8976
